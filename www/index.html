<!DOCTYPE html >
<html>
<header>
	<meta charset="utf-8"/>
    <title>HTML5阅片系统</title>
</header>
<link rel="stylesheet" type="text/css" href="main.css"/>
<body>
<script>
var small_width = document.body.clientWidth/5;
</script>
<div id="big_wrapper">
	<!--<nav id="top_menu">
    	<ul>
        	<li>本地查询</li>
            <li>查看图像</li>
        </ul>	
        
     </nav>-->
     <div class="buttonList">
         <div class="divSep">
            <input id="pointer" type="button"  onclick=	"revert()"/>
            <input id="zoom" type="button"  onclick="revert()"/>
            <input id="move" type="button"  onclick="revert()"/>
        </div>
        <div class="divSep">
            <input id="slayout" type="button"  onclick="revert()"/>
            <input id="ilayout" type="button" onclick="revert()"/>
        </div>
    </div>
    <div id="new_div">
     	<aside id="side_nav"> 
      		<canvas id="canvas_1" width=small_width height=small_width onclick="ShowImage(this.getAttribute('id'))"> 你的浏览器不支持HTML5 </canvas>
      		<br />
      		<canvas id="canvas_2" width=small_width height=small_width onclick="ShowImage(this.getAttribute('id'))"> 你的浏览器不支持HTML5 </canvas>
      		<br />
      		<canvas id="canvas_3"  width=small_width height=small_width onclick="ShowImage(this.getAttribute('id'))"> 你的浏览器不支持HTML5 </canvas>
      		<canvas id="canvas_4"  width=small_width height=small_width onclick="ShowImage(this.getAttribute('id'))"> 你的浏览器不支持HTML5 </canvas>
      		<br />
        </aside>
     	<section id="main_section">
        	<canvas id="canvas_Big"  onclick="Select()"></canvas>
        </section>
     </div>
       <footer id="foot">
       		Copyright Mindray2013!
       </footer>
</div>
<script>
function initImage()
{
	var img1=new Image();
	img1.src="img/small_1.bmp";
	var c1=document.getElementById("canvas_1");
	var ctx1=c1.getContext("2d");
	img1.onload=function()
	{
		
		ctx1.drawImage(img1,0,0,small_width,small_width);
	}
	
	var img2=new Image();
	img2.src="img/small_2.bmp";
	var c2=document.getElementById("canvas_2");
	var ctx2=c2.getContext("2d");
	img2.onload=function()
	{
		
		ctx2.drawImage(img2,0,0,small_width,small_width);
	}
	
	var img3=new Image();
	img3.src="img/small_3.bmp";
	var c3=document.getElementById("canvas_3");
	var ctx3=c3.getContext("2d");
	img3.onload=function()
	{
		
		ctx3.drawImage(img3,0,0,small_width,small_width);
	}
	
	var img4=new Image();
	img4.src="img/small_4.bmp";
	var c4=document.getElementById("canvas_4");
	var ctx4=c4.getContext("2d");
	img4.onload=function()
	{
		
		ctx4.drawImage(img4,0,0,small_width,small_width);
	}
}
var canvas_Big=null;
var context_Big=null;
var bH = 0;
var bW = 0;   

function initSize()
{	            
	if (document.compatMode == "BackCompat") {//兼容模式关闭
		bW = document.body.clientWidth;
		bH = document.body.clientHeight;
	}
	else { //document.compatMode == "CSS1Compat" 兼容模式开启
		bH = document.documentElement.clientHeight;
		bW = document.documentElement.clientWidth; //减去滚动条宽高
	}
	document.getElementById("side_nav").style.height=bH-100+"px";
	document.getElementById("main_section").style.height=bH-107+"px";
}
window.onload=function()
{		
	initSize();
	initImage();
	canvas_Big=document.getElementById("canvas_Big");
	context_Big=canvas_Big.getContext("2d");
	if(bW>1024)
	{
		bW=1024;
	}	
	ShowImage("canvas_1");	
}


function ShowImage(id)
{	
	var index=id.substr(7,1);
	var img=new Image();
	
	img.src="img/big_"+index+".bmp";
	
	img.onload=function()
	{
		if((bH-107)/img.height>=1 &&(bW-236)/img.width>=1)
		{
			document.getElementById("canvas_Big").width=bW-236;
			document.getElementById("canvas_Big").height=bH-107;
			context_Big.drawImage(img,Math.floor((bW-236-img.width)/2),Math.floor((bH-107-img.height)/2));
		}
		 else if((bH-107)/img.height>=1 &&(bW-236)/img.width<1)
		{
			var zoom=Math.floor((bW-236)/img.width*100)/100;
			document.getElementById("canvas_Big").width=img.width*zoom;
			document.getElementById("canvas_Big").height=bH-107;
			context_Big.drawImage(img,0,(bH-107-img.height)/2,img.width*zoom,img.height*zoom);
		}
		else if((bH-107)/img.height<1 &&(bW-236)/img.width>=1)
		{
			var zoom=Math.floor((bH-107)/img.height*100)/100;
			document.getElementById("canvas_Big").width=bW-236;
			document.getElementById("canvas_Big").height=img.height*zoom;
			context_Big.drawImage(img,((bW-236)-img.width)/2,0,img.width*zoom,img.height*zoom);
		}
		else if((bH-107)/img.height<1 &&(bW-236)/img.width<1)
		{
			if((bH-107)/img.height<=(bW-236)/img.width)
			{
				var zoom=Math.floor((bH-107)/img.height*100)/100;
			
			}
			else
			{
				var zoom=Math.floor((bW-236)/img.width*100)/100;
			}
				document.getElementById("canvas_Big").width=bW-236;
				document.getElementById("canvas_Big").height=bH-107;
			context_Big.drawImage(img,Math.floor((bW-236-img.width*zoom)/2),Math.floor((bH-107-img.height*zoom)/2),Math.floor(img.width*zoom),Math.floor(img.height*zoom));
		}
		context_Big.save();
	}
	delete img;	
	
}

//图像反色
function revert()
{
	var w=document.getElementById("canvas_Big").width;
	var h=document.getElementById("canvas_Big").height;
	var imagedata=context_Big.getImageData(0,0,w,h);
			var imagedata1=context_Big.createImageData(w,h);
			for (var j=0;j<h;j++)
			{
				for (var i=0;i<w;i++)
				{
					k=4*(w*j+i);
					imagedata1.data[k+0]=255-imagedata.data[k+0];
					imagedata1.data[k+1]=255-imagedata.data[k+1];
					imagedata1.data[k+2]=255-imagedata.data[k+2];
					imagedata1.data[k+3]=255;					
				}			
			}
	context_Big.putImageData(imagedata1,0,0);
}
function Select()
{
	ifSelect=true;
}

function resetPic()
{
	context_Big.restore();
}
</script>
</body>
</html>
            
	